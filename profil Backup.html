<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boxe Tool Minimal</title>

    <script defer>
        const SUPABASE_URL = 'https://uxrfrtmahfymwuxgprsd.supabase.co/rest/v1/Boxeurs?select=id,LastName,FirstName';
        const API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4cmZydG1haGZ5bXd1eGdwcnNkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0MDUzMTksImV4cCI6MjA4MDk4MTMxOX0.ge8mWR-cejDTxPC2zTm-Xl1eBma1KWro8-SEzM8zblk';

        // Fetch all boxers
        async function getBoxeurs() {
            try {
                const res = await fetch(SUPABASE_URL, {
                    headers: { "apikey": API_KEY, "Authorization": "Bearer " + API_KEY }
                });
                return await res.json();
            } catch (error) {
                console.error("Erreur fetch Supabase :", error);
                return [];
            }
        }

        // Fill select and setup change listener
        async function initSelectBoxeur() {
            const select = document.getElementById('boxeurSelect');
            const result = document.getElementById('selectedResult');
            const boxeurs = await getBoxeurs();

            boxeurs.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b.id;
                opt.textContent = `${b.LastName} ${b.FirstName}`;
                select.appendChild(opt);
            });

            // Display immediately when user selects a boxer
            select.addEventListener('change', () => {
                const opt = select.options[select.selectedIndex];
                if (!opt || !opt.value) {
                    result.innerText = "";
                    return;
                }
                result.innerText = `ID: ${opt.value}, Nom: ${opt.textContent}`;
            });
        }

        // Initialize
        window.addEventListener("DOMContentLoaded", () => {
            initSelectBoxeur();
        });
    </script>
</head>

<body>
    <h1>Liste des Boxeurs</h1>
    <div id="ButtonToShowAllBoxers"></div>
    <div id="ShowAllBoxersResult"></div>

    <h2>Profil des boxeurs</h2>
    <label for="boxeurSelect">Choisissez un boxeur :</label>
    <select id="boxeurSelect">
        <option value="">-- SÃ©lectionnez --</option>
    </select>
    <div id="selectedResult" style="margin-top:10px; font-weight:bold;"></div>
</body>
</html>