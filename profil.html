<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Profil Boxeur</title>
</head>

<body style="font-family:Arial; padding:20px;">
    <h2>Profil boxeur</h2>

    <!-- SELECT BOXEURS -->
    <label for="selectBoxeur"><strong>Choisir un boxeur :</strong></label><br>
    <select id="selectBoxeur" style="margin-top:10px; padding:5px; width:250px;">
        <option value="">-- Sélectionner --</option>
    </select>

    <!-- Zone d'affichage -->
    <div id="result" style="margin-top:20px; font-size:16px; font-weight:bold;"></div>

    <script>
        const SUPABASE_URL = "https://jchxkfyymxayehzhtqwj.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjaHhrZnl5bXhheWVoenRxd2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczMjYzMzc2OSwiZXhwIjoxNzY0MTk5NzY5fQ.IbKYi-7LEPkKRJ9zMv5pU4f5ucTuqWpQOJqzNKkGPWU";

        // Fetch all boxers
        async function getBoxeurs() {
            const { data, error } = await fetch(
                `${SUPABASE_URL}/rest/v1/Boxeurs?select=id,LastName,FirstName,LicenceExpireDate,IsLicencePaid`,
                {
                    headers: {
                        apikey: SUPABASE_KEY,
                        Authorization: "Bearer " + SUPABASE_KEY
                    }
                }
            ).then(r => r.json().then(d => ({ data: d })));

            return data || [];
        }

        // Fill select
        async function chargerSelect() {
            const select = document.getElementById("selectBoxeur");
            const boxeurs = await getBoxeurs();

            boxeurs.forEach(b => {
                const opt = document.createElement("option");
                opt.value = b.id;
                opt.textContent = `${b.LastName} ${b.FirstName}`;

                // Store data in HTML dataset
                opt.dataset.id = b.id;
                opt.dataset.nom = b.LastName;
                opt.dataset.prenom = b.FirstName;
                opt.dataset.licence = b.LicenceExpireDate;
                opt.dataset.paid = b.IsLicencePaid;

                select.appendChild(opt);
            });
        }

        // When selecting a boxer → show instantly
        document.getElementById("selectBoxeur").addEventListener("change", () => {
            const select = document.getElementById("selectBoxeur");
            const opt = select.options[select.selectedIndex];
            const result = document.getElementById("result");

            if (!opt || !opt.dataset.id) {
                result.innerHTML = "";
                return;
            }

            const id = opt.dataset.id;
            const nom = opt.dataset.nom;
            const prenom = opt.dataset.prenom;
            const licence = opt.dataset.licence;
            const paid = opt.dataset.paid === "true" ? "Payé" : "Non payé";

            result.innerHTML = `
                <strong>ID :</strong> ${id}<br>
                <strong>Nom :</strong> ${nom} ${prenom}<br>
                <strong>Licence :</strong> ${licence}<br>
                <strong>Paiement :</strong> ${paid}
            `;
        });

        // Initialize page
        chargerSelect();
    </script>
</body>
</html>